---
title: Transformer
author: ç‹å“²å³°
date: '2022-04-05'
slug: dl-transformer
categories:
  - nlp
tags:
  - tool
---

<style>
details {
    border: 1px solid #aaa;
    border-radius: 4px;
    padding: .5em .5em 0;
}
summary {
    font-weight: bold;
    margin: -.5em -.5em 0;
    padding: .5em;
}
details[open] {
    padding: .5em;
}
details[open] summary {
    border-bottom: 1px solid #aaa;
    margin-bottom: .5em;
}
</style>

<details><summary>ç›®å½•</summary><p>

- [Transformer æ•´ä½“æ¶æ„](#transformer-æ•´ä½“æ¶æ„)
- [åŠ å…¥å¼ é‡çœ‹ Transformer](#åŠ å…¥å¼ é‡çœ‹-transformer)
- [ç¼–ç ](#ç¼–ç )
- [ä»é«˜å¤„çœ‹ Self-attention](#ä»é«˜å¤„çœ‹-self-attention)
- [ä»ç»†èŠ‚çœ‹ Self-attention](#ä»ç»†èŠ‚çœ‹-self-attention)
- [Self-attention çš„çŸ©é˜µè®¡ç®—](#self-attention-çš„çŸ©é˜µè®¡ç®—)
- [å¤šå¤´é‡å…½](#å¤šå¤´é‡å…½)
- [ä½¿ç”¨ä½ç½®ç¼–ç è¡¨å¾åºåˆ—é¡ºåº](#ä½¿ç”¨ä½ç½®ç¼–ç è¡¨å¾åºåˆ—é¡ºåº)
- [æ®‹å·®é¡¹](#æ®‹å·®é¡¹)
- [è§£ç å™¨](#è§£ç å™¨)
- [æœ€åçš„Linearå’ŒSoftmaxå±‚](#æœ€åçš„linearå’Œsoftmaxå±‚)
- [è®­ç»ƒæ¦‚è¦](#è®­ç»ƒæ¦‚è¦)
- [æŸå¤±å‡½æ•°](#æŸå¤±å‡½æ•°)
- [æ—¶é—´åºåˆ— Transformer](#æ—¶é—´åºåˆ—-transformer)
- [å‚è€ƒ](#å‚è€ƒ)
</p></details><p></p>

Transformer æ˜¯ Google åœ¨ 2017 å¹´æå‡ºçš„ä¸€ä¸ª NLP æ¨¡å‹ï¼Œé€‚ç”¨äºæœºå™¨ç¿»è¯‘ä»»åŠ¡ã€‚
å®ƒä¸ä¾èµ–äºä½¿ç”¨ CNN å’Œ RNNï¼Œè€Œæ˜¯åŸºäºå…³æ³¨æœºåˆ¶(Attention)æ„å»ºç½‘ç»œç»“æ„

# Transformer æ•´ä½“æ¶æ„

å¦‚æœæŠŠ Transformer æ¨¡å‹å½“ä½œé»‘ç›’ï¼Œåœ¨æœºå™¨ç¿»è¯‘ä»»åŠ¡é‡Œï¼Œæ¨¡å‹æ¥å—ä¸€ç§è¯­è¨€çš„å¥å­ï¼Œè¾“å‡ºå¦ä¸€ç§è¯­è¨€çš„ç¿»è¯‘å¥å­

![img](images/tf1.png)

æ‰“å¼€ä¸­é—´è¿™ä¸ª Transformer ç»“æ„ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ä¸€ä¸ªç¼–ç æ¨¡å—å’Œä¸€ä¸ªè§£ç æ¨¡å—ï¼Œä¸”å®ƒä»¬äº’ç›¸è¿æ¥

![img](images/ed.png)

ç¼–ç æ¨¡å—æœ‰å¤šä¸ªç¼–ç å™¨å †å è€Œæˆ (è®ºæ–‡å †äº† 6 ä¸ªï¼Œæ•°å­— 6 æ²¡æœ‰ç‰¹åˆ«è§„å®šï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹è¿›è¡Œå®éªŒ)ï¼Œ
è§£ç æ¨¡å—ä¹Ÿå †å äº† 6 ä¸ªè§£ç å™¨

![img](images/ed2.png)

ç¼–ç å™¨ä¹‹é—´éƒ½æ˜¯ç›¸åŒç»“æ„ï¼Œä½†ä¸å…±äº«æƒé‡ã€‚æ¯ä¸ªç¼–ç å™¨æœ‰ä¸¤å±‚ï¼š

![img](images/ed3.png)

ç¼–ç å™¨çš„è¾“å…¥é¦–å…ˆæµå…¥ä¸€ä¸ªè‡ªå…³æ³¨å±‚ (self-attention layer) - å½“ç¼–ç å™¨å¯¹æŸä¸ªç‰¹å®šå•è¯è¿›è¡Œç¼–ç æ—¶ï¼Œ
è¯¥å±‚ä¼šå¸®åŠ©ç¼–ç å™¨å…³æ³¨è¾“å…¥å¥å­ä¸­çš„å…¶å®ƒå•è¯ã€‚åç»­ä¼šè¯¦ç»†è®²è¿™å—

è‡ªå…³æ³¨å±‚çš„è¾“å‡ºä¼šè¢«å–‚å…¥å‰é¦ˆç¥ç»ç½‘ç»œ (feed-forward neural network)ï¼Œæ¯ä¸ªè¾“å…¥ä½ç½®ä¸Šéƒ½æœ‰ä¸€ä¸ªå‰é¦ˆç¥ç»ç½‘ç»œï¼Œ
å®ƒä»¬ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ (è¡¥å……: è®ºæ–‡è¯´å‰é¦ˆç¥ç»ç½‘ç»œæ˜¯ point-wise)

è§£ç å™¨ä¹Ÿæœ‰ç¼–ç å™¨çš„è¿™ä¸¤å±‚ï¼Œä½†æ˜¯åœ¨å®ƒä»¬ä¸­é—´è¿˜æœ‰ä¸ªå…³æ³¨å±‚ï¼Œå¸®åŠ©è§£ç å™¨å…³æ³¨è¾“å…¥å¥å­çš„ç›¸å…³éƒ¨åˆ† (è·Ÿ seq2seq æ¨¡å‹é‡Œçš„å…³æ³¨æœºåˆ¶ç±»ä¼¼)

![img](images/ed4.png)

# åŠ å…¥å¼ é‡çœ‹ Transformer

æˆ‘ä»¬å·²ç»çœ‹è¿‡æ¨¡å‹çš„ä¸»è¦æ¨¡å—ï¼Œç°åœ¨æ¥çœ‹ä¸‹ï¼Œå‘é‡/å¼ é‡æ˜¯å¦‚ä½•åœ¨è¿™äº›æ¨¡å—ä¸­ï¼Œä»è¾“å…¥åˆ°è¾“å‡ºã€‚
ä»¥ NLP å¸¸è§åº”ç”¨çš„ä¸ºä¾‹ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª Embedding ç®—æ³•å°†æ¯ä¸ªè¾“å…¥è¯è½¬åŒ–ä¸ºä¸€ä¸ªå‘é‡ï¼š

![img](images/vec1.png)

Word Embedding åªå‘ç”Ÿåœ¨ç¼–ç å™¨çš„æœ€åº•ç«¯ï¼Œå¯¹äºæ‰€æœ‰ç¼–ç å™¨æ¥è¯´ï¼Œå®ƒä»¬ä¼šæ¥æ”¶ä¸€ä¸ª listï¼Œlist å†…å«æœ‰å¤šä¸ªé•¿åº¦ä¸º 512 çš„è¯å‘é‡ã€‚
ä½†å¯¹å…¶ä»–ç¼–ç å™¨æ¥è¯´ï¼Œå®ƒä»¬çš„è¾“å…¥ä¼šæ˜¯ä¸Šä¸€å±‚ç¼–ç å™¨çš„è¾“å…¥ã€‚list çš„é•¿åº¦æ˜¯å¯è°ƒæ•´çš„è¶…å‚ï¼Œä¸€èˆ¬ä¸ºè®­ç»ƒé›†ä¸­æœ€é•¿å¥å­çš„é•¿åº¦

å¯¹è¾“å…¥åºåˆ—è¿›è¡Œè¯å‘é‡åŒ–åï¼Œæ¯ä¸ªè¯å‘é‡ä¼šä¾æ¬¡æµå…¥ä¸‹é¢ç¼–ç å™¨ä¸­çš„ä¸¤ä¸ªå­å±‚

![img](images/vec2.png)

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ Transformer çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ - å¥å­ä¸­çš„æ¯ä¸ªå¯¹åº”ä½ç½®ä¸Šçš„è¯æ˜¯æŒ‰ç…§å®ƒè‡ªæœ‰è·¯å¾„æµå…¥ç¼–ç å™¨çš„ï¼Œ
åœ¨ self-attention å±‚è¿™äº›è·¯å¾„æ˜¯ç›¸äº’ä¾èµ–çš„ã€‚ä½† Feed-forward å±‚ä¸å­˜åœ¨ä¾èµ–æ€§ï¼Œ
å› æ­¤ï¼Œå½“ self-attention å±‚çš„è¾“å…¥æµå…¥ feed-forward å±‚ï¼Œè¿™äº›ç‹¬ç«‹çš„è·¯å¾„å¯ä»¥å¹¶è¡Œ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç›®å…‰è½¬å‘ä¸€ä¸ªæ›´çŸ­çš„å¥å­ï¼Œæˆ‘ä»¬çœ‹ä¸‹åœ¨ç¼–ç å™¨æ¯ä¸ªå­å±‚é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

# ç¼–ç 

# ä»é«˜å¤„çœ‹ Self-attention

# ä»ç»†èŠ‚çœ‹ Self-attention

# Self-attention çš„çŸ©é˜µè®¡ç®—

# å¤šå¤´é‡å…½

# ä½¿ç”¨ä½ç½®ç¼–ç è¡¨å¾åºåˆ—é¡ºåº

# æ®‹å·®é¡¹

# è§£ç å™¨

# æœ€åçš„Linearå’ŒSoftmaxå±‚

# è®­ç»ƒæ¦‚è¦

# æŸå¤±å‡½æ•°


# æ—¶é—´åºåˆ— Transformer

* https://mp.weixin.qq.com/s/OjK7Q7DSoTM_p1MLye9RWw


# å‚è€ƒ

* [Transformerçš„ä¸€å®¶](https://mp.weixin.qq.com/s/ArzUQHQ-imSpWRPt6XG9FQ)
* [Transformer](https://mp.weixin.qq.com/s?__biz=MzUyNzA1OTcxNg==&mid=2247486160&idx=1&sn=2dfdedb2edbca76a0c7b110ca9952e98&chksm=fa0414bbcd739dad0ccd604f6dd5ed99e8ab7f713ecafc17dd056fc91ad85968844e70bbf398&scene=178&cur_album_id=1577157748566310916#rd)
* [Hugging Face](https://huggingface.co/docs/transformers/quicktour)
* [ğŸ¤— Transformers æ•™ç¨‹ï¼špipelineä¸€é”®é¢„æµ‹](https://mp.weixin.qq.com/s/1dtk5gCa7C-wyVQ9vIuRYw)
